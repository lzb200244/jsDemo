<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>shopping</title>
</head>
<body>
<div id="price"></div>
<div id="mycar"></div>
<div id="app">


</div>
</body>
<script>
    const app = document.getElementById("app")
    let myShopCar = []
    const images = [
        {
            id: "1",
            path: "https://defaultdata-1311013567.cos.ap-nanjing.myqcloud.com/p7.png",
            price: 40,
            store: 10
        },
        {
            id: "2",
            path: "https://defaultdata-1311013567.cos.ap-nanjing.myqcloud.com/p2.png",
            price: 11,
            store: 22
        },
        {
            id: "3",
            path: "https://defaultdata-1311013567.cos.ap-nanjing.myqcloud.com/p3.png",
            price: 13,
            store: 5
        }
    ]
    images.forEach(
        item => {
            const div = document.createElement("div")
            const p = document.createElement("p")
            const img = document.createElement("img")
            const div2 = document.createElement("div")
            const price = document.createElement("span")
            const sub = document.createElement("button")
            const number = document.createElement("span")
            const add = document.createElement("button")
            div2.className = "opt"
            price.className = "price"
            price.innerText = item.price
            sub.className = "sub"
            sub.value = item.id
            sub.innerText = "-"
            number.className = "number"
            number.innerText = item.store
            add.className = "add"
            add.value = item.id
            add.innerText = "+"
            img.src = item.path
            img.width = 40
            div2.append(price)
            div2.append(sub)
            div2.append(number)
            div2.append(add)
            p.append(img)
            div.style.float = 'left'
            div.style.marginLeft = '20px'
            div.append(p)
            div.append(div2)
            app.append(div)

        }
    )
    app.querySelectorAll("#app button").forEach(item =>
        item.addEventListener("click", function () {
            let parentElement = event.target.parentElement
            //库存
            let store = Number(parentElement.querySelector(".number").innerText)
            let addDom = parentElement.querySelector(".add")
            let subDom = parentElement.querySelector(".sub")
            let price = parentElement.querySelector(".price")
            subDom.removeAttribute("disabled")
            addDom.removeAttribute("disabled")
            let {target} = event
            let {value} = target
            let exist = false
            for (const item of myShopCar) {
                if (item.id === value) {
                    //存在
                    exist = true
                    switch (target.innerText) {
                        case "+": {
                            if (store === ++item.count) {
                                addDom.disabled = true
                            }
                            //查找商品丢进购物车
                            break
                        }
                        case "-": {
                            //为0时
                            if (0 === --item.count) {
                                myShopCar = myShopCar.filter(item => item.id !== value)
                                subDom.disabled = true
                            }
                            break
                        }
                    }
                    //循环优化找到退出
                    break
                }
            }
            //不存在购物车且是添加
            if (!exist && target.innerText !== "-") {
                myShopCar.push({
                    id: value,
                    count: 1,
                    price: price.innerText
                })
            }
            renderCar()

        })
    )

    function renderCar() {
        const car = document.getElementById("mycar")
        const price = document.getElementById("price")
        price.innerText = cal()
        car.innerText = JSON.stringify(myShopCar)
    }

    function cal() {
        let sum = 0
        myShopCar.forEach(item => {
            sum += item.count * item.price
        })
        return sum
    }

    renderCar()
</script>
</html>